# 2026-01-27 — Major CRM Build Day

## Key Changes (all pushed to main on both repos)

### Email Import (Mobile)
- Approve/reject from detail panel auto-advances to next email (mobile + desktop)
- Approve/reject from table row does NOT open preview
- Tab bar: equal-width tabs, no scroll, rounded rectangle badges
- Action buttons moved inline below subject (not pinned to bottom)
- "Subject:" label added, "No email body" removed
- Privacy: rejected emails have content wiped from DB

### Outlook Integration
- Full build mirroring Gmail: OAuth2, Microsoft Graph API, token encryption
- Branch `feature/outlook-integration` merged to main
- Env vars: MICROSOFT_CLIENT_ID, MICROSOFT_CLIENT_SECRET, MICROSOFT_TENANT_ID

### Email Verification System
- New page under Outreach → Email Verification
- Pre-send verification popup on campaigns (Send All / Send Only Verified / Verify All / Cancel)
- Email Intelligence DB (global, tracks every email address)
- Smart verify: internal DB first → ZeroBounce only for unknowns
- Bounce detection: scan every 60s for 120min post-send
  - Bounces → mark invalid immediately
  - Replies → mark valid immediately  
  - 120min no bounce → mark valid
- Monthly ZeroBounce refresh endpoint
- Env var: ZEROBOUNCE_API_KEY

### Contacts Page
- Full mobile rewrite: collapsible filters, card-based list
- School field added (DB, form, table, filters, detail page)
- Outreach count column (# of outbound emails sent)
- Alumni toggle (filters by user's school from Settings)
- Font changed to Inter (Google Fonts)
- Compact mobile header

### Communications
- Date input styling normalized for mobile

## Workflow Rules Established
- **Changelog**: After every CRM change, append to `/home/peter-kang/changelog-YYYY-MM-DD.txt`
- Sub-agents must also write to changelog
- Format: `HH:MM AM/PM — Short Title\n  - Description`
- This is saved in TOOLS.md

### Railway Multi-Environment Setup
- Created `feature/email-verification` branch environment for testing
- Frontend: `crm-frontend-mail-testing-feature.up.railway.app`
- Backend: `crm-backend-mail-testing-feature.up.railway.app`
- **Key lesson**: Dockerfile had hardcoded `ENV REACT_APP_API_URL` — overrides Railway env vars. Fixed with `ARG`/`ENV` pattern
- New environments need: Firebase authorized domain, backend `FRONTEND_URL` for CORS, frontend `REACT_APP_API_URL`
- Created migration `025_add_sender_settings.sql` for missing `sender_name`, `school`, `graduation_year`, `division_interest` columns

### Email Import Desktop UI Overhaul (evening session)
- Single toolbar row: [180 days] [Sync Gmail] [Select Multiple] [Approve All] ... [Needs Review | Approved | Rejected]
- Removed title, subtitle, filters bar — maximized content area
- Approve/Reject/Assign buttons moved to fixed bar at bottom of detail panel (separate from scrollable content)
- Subject font shrunk to match From/Date size, inline with "Subject:" label
- Preview pane header shrunk to match table header height
- All toolbar buttons standardized: outlined style, matching heights
- Status tabs: shaded background, constrained to 33.33% width (preview pane alignment), nowrap
- Sort arrows on both DATE and CONTACT columns, active column highlighted in primary color
- Actions column shrunk (90px→65px), more space for subject
- Pre-fetch all three status tabs on load for instant tab switching (no lag)
- Approve All button styled green
- Removed max emails limit (5000 safety cap in backend)
- Fixed `body_text` column error on reject (column doesn't exist, removed from query)

### Communications Mobile Fix
- Table converts to card layout on mobile
- Fixed company "at" prefix (removed entirely per Peter's request)
- Made "# emails sent" bigger on contacts page mobile

## Project Paths (reminder)
- Frontend: ~/CRM-frontend (github: spkang2020/CRM-frontend)
- Backend: ~/CRM-backend (github: spkang2020/CRM-backend)
- Both on `main` branch, deployed via Railway to superdayiq.com
- Dev server not running locally — changes must be pushed to deploy
